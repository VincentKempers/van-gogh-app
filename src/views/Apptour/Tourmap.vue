<template>
    <main>
        <h2>{{ title }}</h2>
        <div class="map">
				<svg
					width="463px"
					height="465px"
					viewBox="0 0 475 536"
					version="1.1"
					xmlns="http://www.w3.org/2000/svg"
					xmlns:xlink="http://www.w3.org/1999/xlink"
					aria-role="application"
				>
					<title>Floor1</title>
					<defs>
						<rect id="path-1" x="51" y="211" width="101" height="20"></rect>
					</defs>
					<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
						<g id="Floor1">
								<polygon id="Path-2" stroke="#000000" stroke-width="4" fill="#FFFFFF" points="97.5924658 260.060486 111.976027 260.060486 111.976027 160.727901 141.479452 160.727901 141.479452 109.799178 111.976027 109.799178 111.976027 34.7582406 160.657534 34.7582406 160.657534 13 308.876712 13 308.876712 34.7582406 411.629281 34.7582406 411.629281 207.521149 461 207.521149 461 308.1183 411.629281 308.1183 411.629281 260.060486 376.141267 260.060486 376.141267 286.736012 308.876712 286.736012 308.876712 331.025758 361.291096 331.025758 361.291096 456 16 456 16 260.060486"></polygon>
								<g id="inside-lines" transform="translate(111.000000, 96.000000)">
									<path d="M3.57311321,273.571429 L3.57311321,320.800786" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<path d="M52.1674528,213.571429 L52.1674528,267.857143" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<path d="M132.205189,269.285714 L132.205189,323.571429" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<path d="M52.1674528,327.857143 L52.1674528,359.285714" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<g id="Rectangle">
										<use fill="#696969" fill-rule="evenodd" xlink:href="#path-1"></use>
										<rect stroke="#656565" stroke-width="3" x="52.5" y="212.5" width="98" height="17"></rect>
									</g>
									<path d="M197.950472,150.714286 L197.950472,182.142857" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<path d="M300.856132,142.142857 L300.856132,159.285714" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<path d="M197.950472,0.714285714 L197.950472,99.2857143" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<path d="M227.964623,87.8571429 L273.700472,87.8571429" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<path d="M2.14386792,166.428571 L2.14386792,236.428571" id="Line" stroke="#656565" stroke-width="3" stroke-linecap="square"></path>
									<polygon id="Path-3" stroke="#000000" stroke-width="3" fill="#D4D4D4" points="51.7354199 39.1753961 51.7354199 164.480408 152.448473 164.480408 152.448473 39.1753961 109.327289 39.1753961 109.327289 81.8658065 63.5669045 81.8658065 63.5669045 39.1753961"></polygon>
								</g>
								<g class="painting-point painting-point--50" transform="translate(347.000000, 149.000000)">
									<router-link tabindex="-1" to="/audio-screen/50">
										<circle @click="paintingClick($event)" 	id="painting--50" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">50</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--28" transform="translate(397.000000, 59.000000)">
									<router-link tabindex="-1" to="/audio-screen/28">
										<circle @click="paintingClick($event)" 	id="painting--28" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">28</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--16" transform="translate(397.000000, 109.000000)">
									<router-link tabindex="-1" to="/audio-screen/16">
										<circle @click="paintingClick($event)" 	id="painting--16" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">16</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--13" transform="translate(397.000000, 159.000000)">
									<router-link tabindex="-1" to="/audio-screen/13">
										<circle @click="paintingClick($event)" 	id="painting--13" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">13</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--41" transform="translate(231.000000, 291.000000)">
									<router-link tabindex="-1" to="/audio-screen/41">
										<circle @click="paintingClick($event)" 	id="painting--41" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">41</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--55" transform="translate(191.000000, 291.000000)">
									<router-link tabindex="-1" to="/audio-screen/55">
										<circle @click="paintingClick($event)" 	id="painting--55" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">55</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--38" transform="translate(211.000000, 375.000000)">
									<router-link tabindex="-1" to="/audio-screen/38">
										<circle @click="paintingClick($event)" 	id="painting--38" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">38</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--18" transform="translate(246.000000, 375.000000)">
									<router-link tabindex="-1" to="/audio-screen/18">
										<circle @click="paintingClick($event)" 	id="painting--18" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">18</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--14" transform="translate(306.000000, 435.000000)">
									<router-link tabindex="-1" to="/audio-screen/14">
										<circle @click="paintingClick($event)" 	id="painting--14" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">14</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--30" transform="translate(206.000000, 435.000000)">
									<router-link tabindex="-1" to="/audio-screen/30">
										<circle @click="paintingClick($event)" 	id="painting--30" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">30</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--2" transform="translate(56.000000, 435.000000)">
									<router-link tabindex="-1" to="/audio-screen/2">
										<circle @click="paintingClick($event)" 	id="painting--2" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="10" y="21">2</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--29" transform="translate(0.000000, 330.000000)">
									<router-link tabindex="-1" to="/audio-screen/29">
										<circle @click="paintingClick($event)" 	id="painting--29" fill="#000000" cx="15" cy="15" 	r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial 	Rounded MT Bold" font-size="17" 	font-weight="normal" letter-spacing="0.29411763" 	fill="#FFFFFF">
											<tspan x="5" y="21">29</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--21" transform="translate(0.000000, 280.000000)">
									<router-link tabindex="-1" to="/audio-screen/53">
										<circle @click="paintingClick($event)" id="painting--53" fill="#000000" cx="15" cy="15" r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial Rounded MT Bold" font-size="17" font-weight="normal" letter-spacing="0.29411763" fill="#FFFFFF">
											<tspan x="5" y="21">53</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--37" transform="translate(174.000000, 0.000000)">
									<router-link tabindex="-1" to="/audio-screen/37">
										<circle @click="paintingClick($event)" id="painting--37" fill="#000000" cx="15" cy="15" r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial Rounded MT Bold" font-size="17" font-weight="normal" letter-spacing="0.29411763" fill="#FFFFFF">
											<tspan x="5" y="21">37</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--4" transform="translate(83.000000, 375.000000)">
									<router-link tabindex="-1" to="/audio-screen/4">
										<circle @click="paintingClick($event)" id="painting--4" fill="#000000" cx="15" cy="15" r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial Rounded MT Bold" font-size="17" font-weight="normal" letter-spacing="0.29411763" fill="#FFFFFF">
											<tspan x="10" y="21">4</tspan>
										</text>
									</router-link>
								</g>
								<g class="painting-point painting-point--76" transform="translate(117.000000, 375.000000)">
									<router-link tabindex="-1" to="/audio-screen/76">
										<circle @click="paintingClick($event)" id="painting--76" fill="#000000" cx="15" cy="15" r="15"></circle>
										<text font-family="ArialRoundedMTBold, Arial Rounded MT Bold" font-size="17" font-weight="normal" letter-spacing="0.29411763" fill="#FFFFFF">
											<tspan x="5" y="21">76</tspan>
										</text>
									</router-link>
								</g>
						</g>
					</g>
				</svg>
        </div>

			<vue-button
				class="btn-confirm"
				v-if="tourStarted"
				:onClick="finishTour"
				:btnText="'Finish Tour'"
			/>
    </main>
</template>

<script>
import VueButton from '../../components/Button';
import { completeTour } from '../../../services/http-service';

export default {
	components: {
		VueButton,
	},
	data() {
		return {
			title: 'Floor 1',
			tourStarted: Number,
			tourId: this.$store.state.tour._id,
			socket: this.$store.state.socket,
		};
	},
	methods: {
		finishTour() {
			this.$store.state.tour.completed = true;
			// completeTour(this.$store.state.tour._id);
			this.socket.emit('completeTour', this.tourId);
			this.$router.push('/');
		},
		paintingClick(evt) {
		},
		displayTour() {
			const points = document.querySelectorAll('.painting-point');

			// get all the painting numbers
			const inTour = this.$store.state.tour.tour.map(painting => painting.painting_no);

			points.forEach(point => {
				// Get the classes from the SVG element
				const classes = point.className.baseVal;
				// Get the index of the division and exclude the '--'
				const divideIndex = classes.indexOf('--') + 2;
				// Get the painting number
				const paintingNumb = point.className.baseVal.substring(divideIndex, classes.length);

				// If the painting number is in the tour show it
				if (inTour.includes(paintingNumb)) {
					point.setAttribute('class', `${point.getAttribute('class')} active`);
					point.setAttribute('tabindex', '0');
				}
			});
		},
	},
	mounted() {
		this.tourStarted = !!this.$store.state.tour.current_way_point; // default is 0 meaning false
		// Display all the tour items when the view is mounted
		this.displayTour();
	}
};
</script>

<style lang="scss" scoped>
#Floor1 > g > text {
	pointer-events: none;
}
main {
	margin: 0 0.8rem;

	h2 {
		position: relative;
		bottom: 1rem;
		color: #4a4a4a;
		width: 60%;
		margin-top: 0;
		margin-left: auto;
		margin-right: .5rem;
		margin-bottom: 0;
	}
	.map {
		width: 100%;
		svg {
			display: block;
			width: 100%;
    		height: 100%;
			max-width: 38rem;
			max-height: 38rem;
			margin: 0 auto;
		}
	}
	// button {
	// 	position: fixed;
	// 	right: 0;
	// 	margin: 0 1rem 0rem 0;
	// 	bottom: 1rem;
	// 	background-color: black;
	// 	color: #f4f4f4;
	// 	padding: 1rem 1.7rem;
	// 	border: none;
	// 	border-radius: 0.5rem;
	// 	width: 10rem;

	// 	.btn-skip {
	// 		width: 50%;
	// 		padding-bottom: 1rem;
	// 		text-decoration: none;
	// 		color: white;
	// 	}
	// }

	.btn-confirm {
		position: fixed;
		bottom: 0;
		right: 0;
		margin: 5%;
	}

	.painting-point {
		display: none;
		&.active {
			display: block;
		}
	}
}
</style>
